<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MetaSync Dashboard</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
      }

      .header {
        text-align: center;
        color: white;
        margin-bottom: 40px;
        animation: fadeIn 0.8s ease-in;
      }

      .header h1 {
        font-size: 3em;
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }

      .header p {
        font-size: 1.2em;
        opacity: 0.9;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        animation: slideUp 0.6s ease-out;
      }

      .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
      }

      .stat-card h3 {
        color: #667eea;
        font-size: 0.9em;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-bottom: 10px;
      }

      .stat-card .value {
        font-size: 2.5em;
        font-weight: bold;
        color: #333;
        margin-bottom: 5px;
      }

      .stat-card .subtitle {
        color: #666;
        font-size: 0.85em;
      }

      .chart-container {
        background: white;
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        animation: slideUp 0.8s ease-out;
      }

      .chart-container h2 {
        color: #333;
        margin-bottom: 20px;
        font-size: 1.5em;
      }

      .language-bar {
        margin-bottom: 15px;
      }

      .language-bar .label {
        display: flex;
        justify-content: space-between;
        margin-bottom: 5px;
        color: #333;
        font-weight: 500;
      }

      .bar-bg {
        background: #f0f0f0;
        border-radius: 10px;
        height: 30px;
        overflow: hidden;
        position: relative;
      }

      .bar-fill {
        height: 100%;
        border-radius: 10px;
        transition: width 1s ease-out;
        display: flex;
        align-items: center;
        justify-content: flex-end;
        padding-right: 10px;
        color: white;
        font-weight: bold;
        font-size: 0.85em;
      }

      .recent-repos {
        background: white;
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        animation: slideUp 1s ease-out;
      }

      .recent-repos h2 {
        color: #333;
        margin-bottom: 20px;
        font-size: 1.5em;
      }

      .repo-item {
        padding: 15px;
        border-bottom: 1px solid #eee;
        transition: background 0.2s ease;
      }

      .repo-item:last-child {
        border-bottom: none;
      }

      .repo-item:hover {
        background: #f9f9f9;
      }

      .repo-name {
        font-weight: bold;
        color: #667eea;
        font-size: 1.1em;
        margin-bottom: 5px;
      }

      .repo-name a {
        color: #667eea;
        text-decoration: none;
      }

      .repo-name a:hover {
        text-decoration: underline;
      }

      .repo-meta {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
        font-size: 0.9em;
        color: #666;
        margin-top: 8px;
      }

      .repo-meta span {
        display: flex;
        align-items: center;
        gap: 5px;
      }

      .badge {
        background: #667eea;
        color: white;
        padding: 3px 8px;
        border-radius: 5px;
        font-size: 0.8em;
      }

      .loading {
        text-align: center;
        padding: 40px;
        color: white;
        font-size: 1.2em;
      }

      .spinner {
        border: 4px solid rgba(255, 255, 255, 0.3);
        border-top: 4px solid white;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
      }

      .error {
        background: #ff6b6b;
        color: white;
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 20px;
        text-align: center;
      }

      .refresh-btn {
        background: white;
        color: #667eea;
        border: none;
        padding: 12px 30px;
        border-radius: 25px;
        font-size: 1em;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        margin: 20px auto;
        display: block;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      }

      .refresh-btn:hover {
        transform: scale(1.05);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
      }

      .last-update {
        text-align: center;
        color: white;
        margin-top: 20px;
        opacity: 0.8;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      @media (max-width: 768px) {
        .header h1 {
          font-size: 2em;
        }

        .stats-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üöÄ MetaSync Dashboard</h1>
        <p>Real-time GitHub Repository Analytics</p>
      </div>

      <div id="error-container"></div>
      <div id="loading" class="loading">
        <div class="spinner"></div>
        <p>Loading dashboard data...</p>
      </div>

      <div id="dashboard" style="display: none">
        <div class="stats-grid">
          <div class="stat-card">
            <h3>Total Repositories</h3>
            <div class="value" id="total-repos">0</div>
            <div class="subtitle">Tracked repos</div>
          </div>
          <div class="stat-card">
            <h3>Total Stars</h3>
            <div class="value" id="total-stars">0</div>
            <div class="subtitle">Combined stars</div>
          </div>
          <div class="stat-card">
            <h3>Total Forks</h3>
            <div class="value" id="total-forks">0</div>
            <div class="subtitle">Combined forks</div>
          </div>
          <div class="stat-card">
            <h3>Lines of Code</h3>
            <div class="value" id="total-lines">0</div>
            <div class="subtitle">Total lines tracked</div>
          </div>
        </div>

        <div class="chart-container">
          <h2>üìä Repositories by Language</h2>
          <div id="language-chart"></div>
        </div>

        <div class="recent-repos">
          <h2>üî• Recently Added Repositories</h2>
          <div id="recent-repos-list"></div>
        </div>

        <button class="refresh-btn" onclick="loadDashboard()">
          üîÑ Refresh Data
        </button>
        <div class="last-update" id="last-update"></div>
      </div>
    </div>

    <script>
      const SUPABASE_URL = "YOUR_SUPABASE_URL"; // Replace with your Supabase URL
      const SUPABASE_ANON_KEY = "YOUR_SUPABASE_ANON_KEY"; // Replace with your Supabase anon key

      const languageColors = {
        Python: "#3776ab",
        Java: "#b07219",
        JavaScript: "#f1e05a",
        HTML: "#e34c26",
        CSS: "#563d7c",
        SQL: "#e38c00",
      };

      async function fetchSupabase(endpoint, options = {}) {
        const response = await fetch(`${SUPABASE_URL}/rest/v1/${endpoint}`, {
          ...options,
          headers: {
            apikey: SUPABASE_ANON_KEY,
            Authorization: `Bearer ${SUPABASE_ANON_KEY}`,
            "Content-Type": "application/json",
            ...options.headers,
          },
        });

        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        return await response.json();
      }

      function formatNumber(num) {
        if (num >= 1000000) {
          return (num / 1000000).toFixed(1) + "M";
        } else if (num >= 1000) {
          return (num / 1000).toFixed(1) + "K";
        }
        return num.toString();
      }

      function animateValue(element, start, end, duration) {
        const range = end - start;
        const increment = range / (duration / 16);
        let current = start;

        const timer = setInterval(() => {
          current += increment;
          if (
            (increment > 0 && current >= end) ||
            (increment < 0 && current <= end)
          ) {
            current = end;
            clearInterval(timer);
          }
          element.textContent = formatNumber(Math.floor(current));
        }, 16);
      }

      async function loadDashboard() {
        try {
          document.getElementById("error-container").innerHTML = "";

          // Fetch all repositories
          const repos = await fetchSupabase(
            "repositories?select=*&order=created_at.desc"
          );

          // Calculate statistics
          const stats = {
            totalRepos: repos.length,
            totalStars: repos.reduce((sum, r) => sum + (r.stars || 0), 0),
            totalForks: repos.reduce((sum, r) => sum + (r.forks || 0), 0),
            totalLines: repos.reduce((sum, r) => sum + (r.lines_count || 0), 0),
          };

          // Update stats with animation
          animateValue(
            document.getElementById("total-repos"),
            0,
            stats.totalRepos,
            1000
          );
          animateValue(
            document.getElementById("total-stars"),
            0,
            stats.totalStars,
            1000
          );
          animateValue(
            document.getElementById("total-forks"),
            0,
            stats.totalForks,
            1000
          );
          animateValue(
            document.getElementById("total-lines"),
            0,
            stats.totalLines,
            1000
          );

          // Group by language
          const languageStats = {};
          repos.forEach((repo) => {
            const lang = repo.language || "Unknown";
            if (!languageStats[lang]) {
              languageStats[lang] = { count: 0, stars: 0 };
            }
            languageStats[lang].count++;
            languageStats[lang].stars += repo.stars || 0;
          });

          // Create language chart
          const maxCount = Math.max(
            ...Object.values(languageStats).map((s) => s.count)
          );
          const languageChartHTML = Object.entries(languageStats)
            .sort((a, b) => b[1].count - a[1].count)
            .map(([lang, data]) => {
              const percentage = (
                (data.count / stats.totalRepos) *
                100
              ).toFixed(1);
              const color = languageColors[lang] || "#888";
              return `
                            <div class="language-bar">
                                <div class="label">
                                    <span>${lang}</span>
                                    <span>${
                                      data.count
                                    } repos (${percentage}%)</span>
                                </div>
                                <div class="bar-bg">
                                    <div class="bar-fill" style="width: ${percentage}%; background: ${color};">
                                        ‚≠ê ${formatNumber(data.stars)}
                                    </div>
                                </div>
                            </div>
                        `;
            })
            .join("");

          document.getElementById("language-chart").innerHTML =
            languageChartHTML;

          // Display recent repos (top 20)
          const recentReposHTML = repos
            .slice(0, 20)
            .map(
              (repo) => `
                    <div class="repo-item">
                        <div class="repo-name">
                            <a href="https://github.com/${
                              repo.full_name
                            }" target="_blank">
                                ${repo.full_name}
                            </a>
                        </div>
                        <div style="color: #666; margin: 5px 0;">${
                          repo.description || "No description"
                        }</div>
                        <div class="repo-meta">
                            <span class="badge">${
                              repo.language || "Unknown"
                            }</span>
                            <span>‚≠ê ${formatNumber(repo.stars)}</span>
                            <span>üç¥ ${formatNumber(repo.forks)}</span>
                            <span>üìù ${formatNumber(
                              repo.lines_count
                            )} lines</span>
                            <span>üìÖ ${new Date(
                              repo.created_at
                            ).toLocaleDateString()}</span>
                        </div>
                    </div>
                `
            )
            .join("");

          document.getElementById("recent-repos-list").innerHTML =
            recentReposHTML || "<p>No repositories found.</p>";

          // Update last update time
          document.getElementById(
            "last-update"
          ).textContent = `Last updated: ${new Date().toLocaleString()}`;

          // Hide loading, show dashboard
          document.getElementById("loading").style.display = "none";
          document.getElementById("dashboard").style.display = "block";
        } catch (error) {
          console.error("Error loading dashboard:", error);
          document.getElementById("error-container").innerHTML = `
                    <div class="error">
                        ‚ùå Error loading data: ${error.message}
                        <br><small>Make sure to update SUPABASE_URL and SUPABASE_ANON_KEY in the HTML file</small>
                    </div>
                `;
          document.getElementById("loading").style.display = "none";
        }
      }

      // Auto-refresh every 30 seconds
      setInterval(loadDashboard, 30000);

      // Initial load
      loadDashboard();
    </script>
  </body>
</html>
